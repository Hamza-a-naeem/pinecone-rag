<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Company Docs Copilot – Web Chat</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root {
        color-scheme: light dark;
        --bg: #0f172a;
        --panel: #020617;
        --accent: #38bdf8;
        --accent-soft: rgba(56, 189, 248, 0.15);
        --border: #1e293b;
        --text: #e5e7eb;
        --text-muted: #9ca3af;
        --error: #ef4444;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: radial-gradient(circle at top, #1d283a 0, #020617 45%);
        color: var(--text);
        min-height: 100vh;
        display: flex;
        align-items: stretch;
        justify-content: center;
      }

      .shell {
        flex: 1;
        max-width: 960px;
        padding: 24px 16px;
        display: flex;
      }

      .card {
        display: flex;
        flex-direction: column;
        width: 100%;
        border-radius: 20px;
        border: 1px solid var(--border);
        background: linear-gradient(
          145deg,
          rgba(15, 23, 42, 0.98),
          rgba(15, 23, 42, 0.96)
        );
        box-shadow:
          0 24px 60px rgba(15, 23, 42, 0.9),
          0 0 0 1px rgba(148, 163, 184, 0.15);
        overflow: hidden;
      }

      .header {
        padding: 16px 20px;
        border-bottom: 1px solid var(--border);
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: radial-gradient(circle at top left, #0f172a 0, #020617 55%);
      }

      .title {
        font-size: 16px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .badge {
        font-size: 11px;
        padding: 3px 8px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.4);
        color: var(--text-muted);
      }

      .status {
        font-size: 11px;
        display: flex;
        align-items: center;
        gap: 6px;
        color: var(--text-muted);
      }

      .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 999px;
        background: #22c55e;
        box-shadow: 0 0 0 6px rgba(34, 197, 94, 0.25);
      }

      .body {
        flex: 1;
        display: flex;
        flex-direction: column;
        padding: 12px 16px 12px;
        gap: 8px;
        background: radial-gradient(circle at top left, #020617 0, #020617 55%);
      }

      .messages {
        flex: 1;
        padding: 8px 4px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .empty-state {
        margin: auto;
        text-align: center;
        color: var(--text-muted);
        font-size: 13px;
        max-width: 320px;
      }

      .empty-state strong {
        color: var(--text);
      }

      .message-row {
        display: flex;
        width: 100%;
      }

      .message-row.user {
        justify-content: flex-end;
      }

      .message-row.bot {
        justify-content: flex-start;
      }

      .bubble {
        max-width: 80%;
        padding: 10px 12px;
        border-radius: 14px;
        font-size: 13px;
        line-height: 1.45;
        word-wrap: break-word;
        white-space: pre-wrap;
      }

      .bubble.user {
        background: linear-gradient(135deg, #38bdf8, #0ea5e9);
        color: #0b1120;
        border-bottom-right-radius: 4px;
      }

      .bubble.bot {
        background: rgba(15, 23, 42, 0.95);
        border: 1px solid rgba(148, 163, 184, 0.3);
        border-bottom-left-radius: 4px;
      }

      .sources {
        margin-top: 4px;
        font-size: 11px;
        color: var(--text-muted);
      }

      .sources span {
        padding: 2px 6px;
        margin-right: 4px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.85);
        border: 1px solid rgba(148, 163, 184, 0.3);
      }

      .error {
        color: var(--error);
        font-size: 12px;
        margin: 4px 0 0;
      }

      .input-row {
        padding: 10px 10px 12px;
        border-radius: 14px;
        border: 1px solid var(--border);
        background: radial-gradient(circle at top, #020617 0, #020617 55%);
        display: flex;
        align-items: flex-end;
        gap: 8px;
      }

      textarea {
        flex: 1;
        resize: none;
        min-height: 44px;
        max-height: 120px;
        border: none;
        outline: none;
        background: transparent;
        color: var(--text);
        font-family: inherit;
        font-size: 13px;
        line-height: 1.4;
      }

      textarea::placeholder {
        color: var(--text-muted);
      }

      button.send {
        border: none;
        outline: none;
        border-radius: 999px;
        padding: 9px 14px;
        font-size: 12px;
        font-weight: 500;
        color: #0b1120;
        background: linear-gradient(135deg, #38bdf8, #22c55e);
        display: inline-flex;
        align-items: center;
        gap: 6px;
        cursor: pointer;
        box-shadow:
          0 0 0 1px rgba(15, 23, 42, 0.8),
          0 10px 30px rgba(56, 189, 248, 0.5);
        transition:
          transform 0.08s ease-out,
          box-shadow 0.08s ease-out,
          opacity 0.08s ease-out;
      }

      button.send span.icon {
        font-size: 13px;
      }

      button.send:disabled {
        opacity: 0.5;
        cursor: default;
        box-shadow: none;
      }

      button.send:not(:disabled):active {
        transform: translateY(1px) scale(0.99);
        box-shadow:
          0 0 0 1px rgba(15, 23, 42, 0.9),
          0 4px 12px rgba(56, 189, 248, 0.4);
      }

      .helper {
        margin-top: 6px;
        display: flex;
        justify-content: space-between;
        font-size: 11px;
        color: var(--text-muted);
      }

      .helper span.key {
        padding: 1px 6px;
        border-radius: 6px;
        border: 1px solid rgba(148, 163, 184, 0.4);
        background: rgba(15, 23, 42, 0.9);
      }
    </style>
  </head>
  <body>
    <div class="shell">
      <div class="card">
        <div class="header">
          <div class="title">
            <span>Company Docs Copilot</span>
            <span class="badge">Web Chat · RAG</span>
          </div>
          <div class="status">
            <span class="status-dot"></span>
            <span id="status-text">Connected to RAG backend</span>
          </div>
        </div>
        <div class="body">
          <div id="messages" class="messages">
            <div class="empty-state" id="empty-state">
              <strong>Ask anything about your company docs.</strong><br /><br />
              This UI calls your existing <code>rag_cli</code> pipeline under the
              hood: embeddings → vector search → RAG answer.
            </div>
          </div>
          <div>
            <div class="input-row">
              <textarea
                id="input"
                placeholder="Ask a question about company policies, product features, or API docs…"
              ></textarea>
              <button id="send" class="send">
                <span class="icon">➤</span>
              </button>
            </div>
            <div class="helper">
              <span
                >Press <span class="key">Enter</span> to send ·
                <span class="key">Shift+Enter</span> for new line</span
              >
              <span id="error" class="error" style="display: none"></span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      const messagesEl = document.getElementById("messages");
      const inputEl = document.getElementById("input");
      const sendEl = document.getElementById("send");
      const errorEl = document.getElementById("error");
      const emptyStateEl = document.getElementById("empty-state");

      function appendMessage(role, text, sources) {
        if (emptyStateEl) {
          emptyStateEl.style.display = "none";
        }

        const row = document.createElement("div");
        row.className = `message-row ${role}`;

        const bubble = document.createElement("div");
        bubble.className = `bubble ${role}`;
        bubble.textContent = text;

        if (role === "bot" && sources && sources.length) {
          const srcEl = document.createElement("div");
          srcEl.className = "sources";
          srcEl.textContent = "Sources: ";
          sources.forEach((s) => {
            const tag = document.createElement("span");
            tag.textContent = s;
            srcEl.appendChild(tag);
          });
          bubble.appendChild(srcEl);
        }

        row.appendChild(bubble);
        messagesEl.appendChild(row);
        messagesEl.scrollTop = messagesEl.scrollHeight;
      }

      function setLoading(loading) {
        sendEl.disabled = loading;
        sendEl.textContent = loading ? "…" : "➤";
      }

      async function sendMessage() {
        const question = inputEl.value.trim();
        if (!question || sendEl.disabled) return;

        errorEl.style.display = "none";
        inputEl.value = "";
        appendMessage("user", question);
        setLoading(true);

        try {
          const resp = await fetch("/api/chat", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ question }),
          });

          if (!resp.ok) {
            throw new Error(`HTTP ${resp.status}`);
          }

          const data = await resp.json();
          appendMessage("bot", data.answer || "(no answer)", data.sources || []);
        } catch (err) {
          console.error(err);
          errorEl.textContent = "Failed to reach backend. Is web_chat.server running?";
          errorEl.style.display = "block";
          appendMessage(
            "bot",
            "I couldn't reach the backend RAG service. Please check that the web server is running.",
            []
          );
        } finally {
          setLoading(false);
          inputEl.focus();
        }
      }

      sendEl.addEventListener("click", sendMessage);

      inputEl.addEventListener("keydown", (e) => {
        if (e.key === "Enter" && !e.shiftKey) {
          e.preventDefault();
          sendMessage();
        }
      });

      inputEl.focus();
    </script>
  </body>
  </html>


